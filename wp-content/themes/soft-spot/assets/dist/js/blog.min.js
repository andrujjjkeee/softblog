$( function() {

    $( '#popup' ).each(function(){
        new Popup($(this));
    } );

} );

var Popup = function( obj ) {
    //private properties
    var _self = this,
        _btnShow =  $( '.popup__open' ),
        _obj = obj,
        _popupWrap = _obj.find( '#popup__wrap' ),
        _popupContents = _obj.find( '.popup__content' ),
        _btnClose = _obj.find( '.popup__close' ),
        _textFrame,
        _scrollContainer = $( 'html' ),
        _body = $( 'body' ),
        _site = _body.find( '#site' ),
        _position = 0,
        _timerClosePopup,
        _window = $( window );

    //private methods
    var _getScrollWidth = function (){
            var scrollDiv = document.createElement( 'div' ),
                scrollBarWidth;

            scrollDiv.className = 'popup__scrollbar-measure';

            document.body.appendChild( scrollDiv );

            scrollBarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;

            document.body.removeChild(scrollDiv);

            return scrollBarWidth;

        },
        _hidePopup = function(){

            _obj.addClass( 'is-hide' ).removeClass( 'is-opened' );

            clearTimeout( _timerClosePopup );

            _obj.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function() {

                _scrollContainer.css( {
                    overflowY: 'auto',
                    paddingRight: 0
                } );
                _body.removeAttr( 'style' );
                _site.removeAttr( 'style' );
                _obj.removeAttr( 'style' );

                _window.scrollTop( _position );
                _position = 0;

                _obj.removeClass( 'is-hide' );

                if ( _textFrame != null ) {
                    _request.abort();
                    _textFrame.empty();
                    _textFrame = null;
                }

                _obj.addClass( 'is-loading' );

                _obj.off( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend' );

            } );

        },
        _onEvents = function(){

            _obj.on( 'click', function ( e ) {

                if ( $( e.target ).closest( _popupContents ).length === 0 ){
                    _hidePopup();
                }

            } );

            _btnShow.on( 'click', function() {

                var curBtn = $( this ),
                    curClass = curBtn.data( 'popup' );

                _showPopup( curClass );
                return false;
            } );

            _btnClose.on( 'click', function(){
                _hidePopup();
                return false;
            } );

        },
        _showPopup = function( className ){

            _setPopupContent( className );

            if ( _window.scrollTop() !== 0 ){
                _position = _window.scrollTop();
            }

            _scrollContainer.css( {
                overflowY: 'hidden',
                paddingRight: _getScrollWidth()
            } );

            _body.css( 'overflow-y', 'hidden' );

            _site.css( {
                'position': 'relative',
                'top': _position * -1
            } );

            if ( _popupWrap.outerHeight() <= _window.outerHeight() ) {
                _obj.css( {
                    paddingRight: _getScrollWidth()
                } );
            }

            _obj.addClass( 'is-opened' );

        },
        _setPopupContent = function( className ){

            var popupContent = className,
                curContent = _popupContents.filter( '.popup_' + popupContent );

            _popupContents.css( { display: 'none' } );
            curContent.css( { display: 'block' } );

            if ( popupContent === 'thanks' ) { _commonPopupSet() }

        },
        _commonPopupSet = function () {

            _obj.removeClass( 'is-loading' );

            _timerClosePopup = setTimeout( function () {
                _hidePopup();
                clearTimeout( _timerClosePopup );
            }, 5000 );

        },
        _construct = function(){

            _onEvents();
            _obj[ 0 ].obj = _self;

        };

    //public properties

    //public methods
    _self.openPopup = function ( obj ) {
        _showPopup( obj );
    };
    _self.closePopup = function () {
        _hidePopup();
    };

    _construct();

};
( function(){

    $( function () {

        "use strict";

        new Menu();

    } );

    var Menu = function( ) {

        //private properties
        var _obj = $( '#site-header__mobile-wrap' ),
            _wrap = _obj.find( '#site-header__mobile-layout' ),
            _mobileBtn = $( '#hamburger' ),
            _html = $( 'html' ),
            _body = $( 'body' ),
            _site = _body.find( '#site' ),
            _siteHeader = _site.find( '#site__header' ),
            _window = $( window ),
            _position = 0;

        //private methods
        var _onEvent = function() {

                _window.on( 'resize', function () {

                    if ( _window.outerWidth() > 992 ){
                        _mobileBtn.removeClass( 'is-active' );
                        _siteHeader.removeClass( 'is-active' );
                    }

                } );

                _site.on( 'click', function ( e ) {
                    if ( $( e.target ).closest( _obj ).length === 0 && $( e.target ).closest( _mobileBtn ).length === 0 && _obj.hasClass( 'is-show' ) ){
                        _hideMenu();
                    }
                } );

                _mobileBtn.on( 'click', function () {

                    if ( $( this ).hasClass( 'is-active' ) ){
                        _hideMenu();
                    } else {
                        _showMenu();
                    }

                } );

            },
            _hideMenu = function () {

                _mobileBtn.removeClass( 'is-active' );
                _siteHeader.removeClass( 'is-active' );

                _obj.removeClass( 'is-show' );
                _obj.removeAttr( 'style' );

                if ( _window.outerWidth() < 992 ){

                    _html.css( 'overflow-y', 'visible' );
                    _body.removeAttr( 'style' );
                    _site.removeAttr( 'style' );

                    _window.scrollTop( _position );

                }

            },
            _showMenu = function () {

                _mobileBtn.addClass( 'is-active' );
                _siteHeader.addClass( 'is-active' );

                _obj.addClass( 'is-show' );
                _obj.css( 'height', _wrap.outerHeight() + 20 );

                if ( _window.outerWidth() < 992 ){

                    _position = _window.scrollTop();

                    _html.css( 'overflow-y', 'hidden' );
                    _body.css( 'overflow-y', 'hidden' );

                    _site.css( {
                        'position': 'relative',
                        'top': _position * -1
                    } );

                }

            },
            _construct = function() {
                _onEvent();
            };

        //public properties

        //public methods

        _construct();
    };

} )();
( function(){

    "use strict";

    $( function () {

        Preloader();

        /*$.each( $( '.popup__notifications' ), function() {
                    new TrueUser ();
                } );*/

        $.each( $( '#blog' ), function() {
            new Blog ( $( this ) );
        } );

        $.each( $( '#search' ), function() {
            new SearchForm ( $( this ) );
        } );

        $.each( $( '#to-top' ), function() {
            new ToTop ( $( this ) );
        } );

        $.each( $( 'iframe' ), function() {
            new SetSizeIframe ( $( this ) );
        } );

    } );

    var Blog = function ( obj ) {

        var _obj = obj,
            _blogWrap = _obj.find( '#blog__wrap' ),
            _blogList = _blogWrap.find( '#blog__list' ),
            _blogLoadMore = _obj.find( '#blog__load-more' ),
            _categoryList = $( '.categories' ),
            _categoryItem = _categoryList.find( '.categories__item' ),
            _currentId = _categoryItem.filter( '.is-active' ).data( 'id' ),
            _currentPage = 2,
            _maxPage = 2,
            _canSendRequest = true,
            // _url = 'php/blog.json',
            _url = $( '#site__wrap' ).data( 'action' ),
            _request = new XMLHttpRequest(),
            _window = $( window ),
            _body = $( 'html, body' ),
            _monthNames = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];

        var _onEvents = function() {

                _window.on( {
                    'scroll': function () {
                        if ( ( _window.outerWidth() >= 768 ) &&  ( _window.scrollTop() + _window.height() >= _blogWrap.offset().top + _blogWrap.outerHeight() - 10 ) ) {
                            _loadData();
                        }
                    },
                    'resize': function () {
                        _blogWrap.css( 'height', _blogList.outerHeight() );
                    }
                } );

                _categoryItem.on( 'click', function () {
                    _changeCategory( $(this) );
                    return false;
                } );

                _blogLoadMore.on( 'click', function () {
                    _loadData();
                    return false;
                } );

            },
            _changeCategory = function ( obj ) {

                _currentPage = 1;
                _maxPage = 1;
                _canSendRequest = true;

                _categoryItem.removeClass( 'is-active' );
                obj.addClass( 'is-active' );

                _blogList.empty();
                _blogWrap.css( 'height', _window.outerHeight() / 2 );

                _currentId = obj.data( 'id' );

                _loadData();

                if ( _window.outerWidth() < 768 ) {
                    _blogWrap.css( 'height', _blogList.outerHeight() );

                    _body.animate( {
                        scrollTop: 0
                    }, 600);
                }

            },
            _setBlogItem = function ( data ) {

                var blogItem = data,
                    blogItemLink = blogItem.link,
                    blogItemImage = blogItem.image,
                    blogItemTitle = blogItem.title,
                    blogItemContent = blogItem.content,
                    blogItemDate = blogItem.date,
                    dateArr = blogItemDate.split('-'),
                    frameItem = $( '<article class="blog__item is-new" />' ),
                    blogContent;

                if ( blogItemImage ){
                    frameItem.append( '<a href="'+ blogItemLink +'" class="blog__picture"><img src="'+ blogItemImage +'" alt="'+ blogItemTitle +'"/></a>' );
                }

                blogContent = '<div class="blog__item-wrap"><div class="blog__info">' +
                    '<time class="blog__date" datetime="blogItemDate">'+ _monthNames[ dateArr[1] - 1 ] +' '+ dateArr[2] +', '+ dateArr[0] +'</time>' +
                    '<a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fsoftspotapp.com%2Fblog%2F&ref_src=twsrc%5Etfw&screen_name=softspotapp&tw_p=followbutton" class="twttr">\n' +
                    '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 49.3 40" style="enable-background:new 0 0 49.3 40;" xml:space="preserve">' +
                    '<path d="M49.3,4.7c-1.8,0.8-3.8,1.3-5.8,1.6c2.1-1.2,3.7-3.2,4.4-5.6c-2,1.2-4.1,2-6.4,2.5C39.6,1.2,37,0,34.1,0' +
                    'C28.5,0,24,4.5,24,10.1c0,0.8,0.1,1.6,0.3,2.3C15.9,12,8.4,8,3.4,1.8C2.6,3.3,2.1,5.1,2.1,6.9c0,3.5,1.8,6.6,4.5,8.4' +
                    'c-1.7-0.1-3.2-0.5-4.6-1.3c0,0,0,0.1,0,0.1c0,4.9,3.5,9,8.1,9.9c-0.8,0.2-1.7,0.4-2.7,0.4c-0.7,0-1.3-0.1-1.9-0.2c1.3,4,5,6.9,9.4,7' +
                    'c-3.5,2.7-7.8,4.3-12.6,4.3c-0.8,0-1.6,0-2.4-0.1C4.5,38.4,9.8,40,15.5,40c18.6,0,28.8-15.4,28.8-28.8c0-0.4,0-0.9,0-1.3' +
                    'C46.2,8.5,47.9,6.8,49.3,4.7z"/></svg>Follow @softspotapp</a></div>' +
                    '<a href="'+ blogItemLink +'" class="blog__content"><h2 class="blog__topic"><span>'+ blogItemTitle +'</span></h2>' +
                    '<div class="blog__text"><p>'+ blogItemContent +'</p></div></a></div>';

                frameItem.append( blogContent );

                return frameItem;

            },
            _loadData = function () {

                if( _canSendRequest && _currentPage <= _maxPage ){
                    _sendRequest();
                }

            },
            _sendRequest = function() {

                _canSendRequest = false;

                _request.abort();
                _blogWrap.addClass( 'is-loading' ).removeClass( 'is-empty' );

                _request = $.ajax( {
                    url: _url,
                    data: {
                        action: 'get_posts_by_category',
                        page: _currentPage,
                        taxId: _currentId
                    },
                    dataType: 'json',
                    timeout: 20000,
                    type: 'POST',
                    success: function ( data ) {
                        _setList( data );
                    },
                    error: function ( XMLHttpRequest ) {
                        if ( XMLHttpRequest.statusText != "abort" ) {
                            console.error( 'err' );
                        }
                    }
                } );

            },
            _setList = function( data ) {

                _maxPage = data.maxPages;

                if ( _maxPage === 0 ){
                    _blogLoadMore.addClass( 'is-hidden' );
                    _blogWrap.removeClass( 'is-loading' );
                    return false;
                }

                var blogData = data.blog,
                    blogItemTotal = blogData.length;

                if ( blogItemTotal === 0 ){
                    _canSendRequest = false;
                    _blogWrap.addClass( 'is-empty' ).removeClass( 'is-loading' );
                    return false;
                }

                $.each( blogData, function( index ) {

                    var blogFrame = _setBlogItem( this );

                    _blogList.append( blogFrame );

                    if ( index === blogItemTotal - 1 ){
                        _blogWrap.removeClass( 'is-loading' );
                        _canSendRequest = true;

                        _blogWrap.css( 'height', _blogList.outerHeight() );

                        var newItem = _blogList.find( '.is-new' );

                        newItem.each( function ( i ) {

                            var curItem = $( this );

                            _showNewItems( curItem, i );

                        } );

                        var image = newItem.find( 'img' );

                        image.on( 'load', function () {
                            _blogWrap.css( 'height', _blogList.outerHeight() );
                        } );

                    }

                } );

                _currentPage = _currentPage + 1;

                if ( _currentPage > _maxPage  ) {
                    _blogLoadMore.addClass( 'is-hidden' )
                } else {
                    _blogLoadMore.removeClass( 'is-hidden' );
                    _canSendRequest = true;
                }

            },
            _showNewItems = function ( item, index ) {

                var curItem = item;

                setTimeout( function() {
                    curItem.removeClass( 'is-new' );
                }, 100 * index );

            },
            _construct = function() {
                _onEvents();
                _loadData();
            };

        _construct()
    };

    var SearchForm = function( obj ) {

        //private properties
        var _obj = obj,
            _searchForm = _obj.find( '#search__form' ),
            _searchInput = _searchForm.find( 'input' ),
            _searchPopup = _obj.find( '#search__popup' ),
            _searchPopupScrollWrap = _searchPopup.find( '#search__popup-scroll-wrap' ),
            _resultWrap = _searchPopup.find( '#search__result' ),
            // _url = 'php/search.json',
            _url = $( $( '#site__wrap' ) ).data( 'action' ),
            _site = $( '#site' ),
            _ps = null,
            _timer = null,
            _witchLetterStat = 2,
            _request = new XMLHttpRequest();

        //private methods
        var _onEvent = function () {

                _site.on( 'click', function ( e ) {

                    if ( _searchPopup.hasClass( 'is-show' ) && $( e.target ).closest( _obj ).length == 0 ){
                        _hidePopup();
                    }

                } );

                _searchInput.on ( 'keyup', function( e ) {

                    var symbolNumber = _searchInput.val().length;

                    switch ( e.keyCode ) {
                        case 27:
                            _hidePopup();
                            break;
                        case 13, 27, 37, 38, 39, 40:
                            (e).preventDefault();
                            break;
                        default:
                            if( symbolNumber > _witchLetterStat ){

                                _request.abort();
                                clearTimeout( _timer );

                                _timer = setTimeout( function () {
                                    _searchForm.hasClass( 'is-show' ) ? _ajaxRequest() : _showPopup();
                                }, 500 );

                            } else if ( symbolNumber <= _witchLetterStat ) {

                                _request.abort();
                                clearTimeout( _timer );
                                _hidePopup();

                            }
                    }

                } );

            },
            _ajaxRequest = function () {

                _searchPopup.addClass( 'is-loading' );

                _request.abort();

                _request = $.ajax( {
                    url: _url,
                    data: {
                        action: 'get_search_result',
                        search_value: _searchInput.val()
                    },
                    dataType: 'json',
                    type: 'POST',
                    success: function ( data ) {
                        _loadData( data );
                    },
                    error: function ( XMLHttpRequest ) {
                        if ( XMLHttpRequest.statusText != "abort" ) {
                            console.error( 'err' );
                        }
                    }
                } );

            },
            _loadData = function ( data ) {

                var info;

                info = data.result;

                _resultWrap.empty();

                if ( !info ){
                    _searchPopup.addClass( 'is-empty' ).removeClass( 'is-loading' );

                    if ( _ps !== null ) {
                        _ps.destroy();
                        _ps = null;
                    }

                    return false;
                }

                var recipesTotal = info.length;

                if ( recipesTotal !== 0 ){

                    _searchPopup.removeClass( 'is-empty' );

                    $.each( info, function( index ) {

                        var recipesItem = _createItemFrame( this );

                        _resultWrap.append( recipesItem );

                        if ( index === recipesTotal - 1 ){

                            _searchPopup.removeClass( 'is-loading' );

                            _setWrapHeight();
                        }

                    } );

                } else {
                    _searchPopup.addClass( 'is-empty' ).removeClass( 'is-loading' );

                    if ( _ps !== null ) {
                        _ps.destroy();
                        _ps = null;
                    }

                }

            },
            _createItemFrame = function ( data ) {

                var recipesItem = data,
                    recipesItemLink = recipesItem.link,
                    recipesItemTitle = recipesItem.title,
                    frameItem = null;

                frameItem = '<a href="'+ recipesItemLink +'" class="search__result-item">' +
                    '<p>'+ recipesItemTitle +'</p></a>';

                return frameItem;

            },
            _showPopup = function () {

                _searchPopup.addClass( 'is-show' );
                _ajaxRequest();

            },
            _setWrapHeight = function () {

                _searchPopup.css( 'height', _resultWrap.outerHeight() + 37 );

                _searchPopup.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function () {
                    if ( _ps == null ){
                        _initScroll();
                    } else {
                        _ps.update();
                    }
                    _searchPopup.off( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend' );
                } );

            },
            _hidePopup = function () {

                if ( !_searchPopup.hasClass( 'is-show' ) ){
                    return false;
                }

                _searchPopup.removeClass( 'is-show' );

                _searchPopup.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function() {
                    _resultWrap.empty();

                    if ( _ps !== null ) {
                        _ps.destroy();
                        _ps = null;
                    }

                    _searchPopup.off( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend' );

                } );


            },
            _initScroll = function () {

                if ( _searchPopupScrollWrap.outerHeight() > _searchPopup.outerHeight() - 37 ){

                    var searchPopupScrollWrap = document.querySelector( '#search__popup-scroll-wrap' );

                    _ps = new PerfectScrollbar( searchPopupScrollWrap, {
                        suppressScrollX: true
                    } );

                }

            },
            _construct = function() {
                _onEvent();
            };

        //public properties

        //public methods

        _construct();

    };

    var SetSizeIframe = function (obj) {

        //private properties
        var _obj = obj,
            _window = $( window );

        //private methods
        var _onEvent = function() {

                _window.on( 'resize', function () {
                    _setSize();
                } );

            },
            _setSize = function () {

                var videoWidth = _obj.outerWidth();

                _obj.css( 'height', videoWidth / 1.7777 + 'px' );

            },
            _construct = function() {
                _onEvent();
                _setSize();
            };

        //public properties

        //public methods

        _construct();

    };

    var ToTop = function( obj ) {

        //private properties
        var _obj = obj,
            _aside = $( '#site__aside' ),
            _body = $( 'html, body' ),
            _window = $( window );

        //private methods
        var _onEvent = function () {

                _window.on( 'scroll', function () {
                    if ( _window.scrollTop() >= _aside.offset().top + _aside.outerHeight() ) {
                        _obj.addClass( 'is-show' )
                    } else {
                        _obj.removeClass( 'is-show' )
                    }
                } );

                _obj.on( {
                    click: function() {

                        var curBtn = $( this );

                        _body.animate( {
                            scrollTop: 0
                        }, 600);

                        return false;
                    }
                } );

            },
            _construct = function() {
                _onEvent();
            };

        //public properties

        //public methods

        _construct();

    };

    var TrueUser = function(){

        //private properties

        //private methods
        var _checkUser = function () {

                // var trueUser = localStorage.getItem( 'trueUserSoftSpot' );

                // if ( !trueUser ) {
                $( '#popup' )[0].obj.openPopup( 'notifications' );
                // localStorage.setItem( 'trueUserSoftSpot', true )
                // }

            },
            _construct = function(){
                _checkUser();
            };

        //public properties

        //public methods

        _construct();

    };

    function Preloader () {

        var preloader = document.getElementById( 'preload' ),
            loadingLine = document.getElementById( 'preload__loading-line' ),
            heroSection;

        // OnEvents
        window.addEventListener( 'load', LoadLine );

        // Functions
        function LoadLine () {

            loadingLine.classList.add( 'load' );

            ShowSite();

        }
        function ShowSite () {

            preloader.classList.add( 'preload_loaded' );

            preloader.addEventListener( 'transitionend', function ( e ) {
                ( e.propertyName === 'opacity' ) && preloader.remove();

                if ( document.querySelectorAll( '.is-loading' ).length > 0 ) {
                    $( '.is-loading' ).removeClass( 'is-loading' );
                }

            } );

        }

    }

} )();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5wb3B1cC5qcyIsImpxdWVyeS5tYWluLmpzIiwianF1ZXJ5LmJsb2cuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJibG9nLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiQoIGZ1bmN0aW9uKCkge1xuXG4gICAgJCggJyNwb3B1cCcgKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgIG5ldyBQb3B1cCgkKHRoaXMpKTtcbiAgICB9ICk7XG5cbn0gKTtcblxudmFyIFBvcHVwID0gZnVuY3Rpb24oIG9iaiApIHtcbiAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgIHZhciBfc2VsZiA9IHRoaXMsXG4gICAgICAgIF9idG5TaG93ID0gICQoICcucG9wdXBfX29wZW4nICksXG4gICAgICAgIF9vYmogPSBvYmosXG4gICAgICAgIF9wb3B1cFdyYXAgPSBfb2JqLmZpbmQoICcjcG9wdXBfX3dyYXAnICksXG4gICAgICAgIF9wb3B1cENvbnRlbnRzID0gX29iai5maW5kKCAnLnBvcHVwX19jb250ZW50JyApLFxuICAgICAgICBfYnRuQ2xvc2UgPSBfb2JqLmZpbmQoICcucG9wdXBfX2Nsb3NlJyApLFxuICAgICAgICBfdGV4dEZyYW1lLFxuICAgICAgICBfc2Nyb2xsQ29udGFpbmVyID0gJCggJ2h0bWwnICksXG4gICAgICAgIF9ib2R5ID0gJCggJ2JvZHknICksXG4gICAgICAgIF9zaXRlID0gX2JvZHkuZmluZCggJyNzaXRlJyApLFxuICAgICAgICBfcG9zaXRpb24gPSAwLFxuICAgICAgICBfdGltZXJDbG9zZVBvcHVwLFxuICAgICAgICBfd2luZG93ID0gJCggd2luZG93ICk7XG5cbiAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgIHZhciBfZ2V0U2Nyb2xsV2lkdGggPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgIHZhciBzY3JvbGxEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApLFxuICAgICAgICAgICAgICAgIHNjcm9sbEJhcldpZHRoO1xuXG4gICAgICAgICAgICBzY3JvbGxEaXYuY2xhc3NOYW1lID0gJ3BvcHVwX19zY3JvbGxiYXItbWVhc3VyZSc7XG5cbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIHNjcm9sbERpdiApO1xuXG4gICAgICAgICAgICBzY3JvbGxCYXJXaWR0aCA9IHNjcm9sbERpdi5vZmZzZXRXaWR0aCAtIHNjcm9sbERpdi5jbGllbnRXaWR0aDtcblxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzY3JvbGxEaXYpO1xuXG4gICAgICAgICAgICByZXR1cm4gc2Nyb2xsQmFyV2lkdGg7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2hpZGVQb3B1cCA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgIF9vYmouYWRkQ2xhc3MoICdpcy1oaWRlJyApLnJlbW92ZUNsYXNzKCAnaXMtb3BlbmVkJyApO1xuXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQoIF90aW1lckNsb3NlUG9wdXAgKTtcblxuICAgICAgICAgICAgX29iai5vbiggJ3dlYmtpdFRyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQgb1RyYW5zaXRpb25FbmQgbXNUcmFuc2l0aW9uRW5kIHRyYW5zaXRpb25lbmQnLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIF9zY3JvbGxDb250YWluZXIuY3NzKCB7XG4gICAgICAgICAgICAgICAgICAgIG92ZXJmbG93WTogJ2F1dG8nLFxuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6IDBcbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgICAgX2JvZHkucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuICAgICAgICAgICAgICAgIF9zaXRlLnJlbW92ZUF0dHIoICdzdHlsZScgKTtcbiAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUF0dHIoICdzdHlsZScgKTtcblxuICAgICAgICAgICAgICAgIF93aW5kb3cuc2Nyb2xsVG9wKCBfcG9zaXRpb24gKTtcbiAgICAgICAgICAgICAgICBfcG9zaXRpb24gPSAwO1xuXG4gICAgICAgICAgICAgICAgX29iai5yZW1vdmVDbGFzcyggJ2lzLWhpZGUnICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF90ZXh0RnJhbWUgIT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgX3JlcXVlc3QuYWJvcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgX3RleHRGcmFtZS5lbXB0eSgpO1xuICAgICAgICAgICAgICAgICAgICBfdGV4dEZyYW1lID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuICAgICAgICAgICAgICAgIF9vYmoub2ZmKCAnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCcgKTtcblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9vbkV2ZW50cyA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgIF9vYmoub24oICdjbGljaycsIGZ1bmN0aW9uICggZSApIHtcblxuICAgICAgICAgICAgICAgIGlmICggJCggZS50YXJnZXQgKS5jbG9zZXN0KCBfcG9wdXBDb250ZW50cyApLmxlbmd0aCA9PT0gMCApe1xuICAgICAgICAgICAgICAgICAgICBfaGlkZVBvcHVwKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9idG5TaG93Lm9uKCAnY2xpY2snLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIHZhciBjdXJCdG4gPSAkKCB0aGlzICksXG4gICAgICAgICAgICAgICAgICAgIGN1ckNsYXNzID0gY3VyQnRuLmRhdGEoICdwb3B1cCcgKTtcblxuICAgICAgICAgICAgICAgIF9zaG93UG9wdXAoIGN1ckNsYXNzICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfYnRuQ2xvc2Uub24oICdjbGljaycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgX2hpZGVQb3B1cCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfc2hvd1BvcHVwID0gZnVuY3Rpb24oIGNsYXNzTmFtZSApe1xuXG4gICAgICAgICAgICBfc2V0UG9wdXBDb250ZW50KCBjbGFzc05hbWUgKTtcblxuICAgICAgICAgICAgaWYgKCBfd2luZG93LnNjcm9sbFRvcCgpICE9PSAwICl7XG4gICAgICAgICAgICAgICAgX3Bvc2l0aW9uID0gX3dpbmRvdy5zY3JvbGxUb3AoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgX3Njcm9sbENvbnRhaW5lci5jc3MoIHtcbiAgICAgICAgICAgICAgICBvdmVyZmxvd1k6ICdoaWRkZW4nLFxuICAgICAgICAgICAgICAgIHBhZGRpbmdSaWdodDogX2dldFNjcm9sbFdpZHRoKClcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgX2JvZHkuY3NzKCAnb3ZlcmZsb3cteScsICdoaWRkZW4nICk7XG5cbiAgICAgICAgICAgIF9zaXRlLmNzcygge1xuICAgICAgICAgICAgICAgICdwb3NpdGlvbic6ICdyZWxhdGl2ZScsXG4gICAgICAgICAgICAgICAgJ3RvcCc6IF9wb3NpdGlvbiAqIC0xXG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIGlmICggX3BvcHVwV3JhcC5vdXRlckhlaWdodCgpIDw9IF93aW5kb3cub3V0ZXJIZWlnaHQoKSApIHtcbiAgICAgICAgICAgICAgICBfb2JqLmNzcygge1xuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6IF9nZXRTY3JvbGxXaWR0aCgpXG4gICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtb3BlbmVkJyApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRQb3B1cENvbnRlbnQgPSBmdW5jdGlvbiggY2xhc3NOYW1lICl7XG5cbiAgICAgICAgICAgIHZhciBwb3B1cENvbnRlbnQgPSBjbGFzc05hbWUsXG4gICAgICAgICAgICAgICAgY3VyQ29udGVudCA9IF9wb3B1cENvbnRlbnRzLmZpbHRlciggJy5wb3B1cF8nICsgcG9wdXBDb250ZW50ICk7XG5cbiAgICAgICAgICAgIF9wb3B1cENvbnRlbnRzLmNzcyggeyBkaXNwbGF5OiAnbm9uZScgfSApO1xuICAgICAgICAgICAgY3VyQ29udGVudC5jc3MoIHsgZGlzcGxheTogJ2Jsb2NrJyB9ICk7XG5cbiAgICAgICAgICAgIGlmICggcG9wdXBDb250ZW50ID09PSAndGhhbmtzJyApIHsgX2NvbW1vblBvcHVwU2V0KCkgfVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb21tb25Qb3B1cFNldCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgX29iai5yZW1vdmVDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG5cbiAgICAgICAgICAgIF90aW1lckNsb3NlUG9wdXAgPSBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX2hpZGVQb3B1cCgpO1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCggX3RpbWVyQ2xvc2VQb3B1cCApO1xuICAgICAgICAgICAgfSwgNTAwMCApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBfb25FdmVudHMoKTtcbiAgICAgICAgICAgIF9vYmpbIDAgXS5vYmogPSBfc2VsZjtcblxuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuICAgIF9zZWxmLm9wZW5Qb3B1cCA9IGZ1bmN0aW9uICggb2JqICkge1xuICAgICAgICBfc2hvd1BvcHVwKCBvYmogKTtcbiAgICB9O1xuICAgIF9zZWxmLmNsb3NlUG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9oaWRlUG9wdXAoKTtcbiAgICB9O1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59OyIsIiggZnVuY3Rpb24oKXtcblxuICAgICQoIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICAgICBuZXcgTWVudSgpO1xuXG4gICAgfSApO1xuXG4gICAgdmFyIE1lbnUgPSBmdW5jdGlvbiggKSB7XG5cbiAgICAgICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICAgICAgdmFyIF9vYmogPSAkKCAnI3NpdGUtaGVhZGVyX19tb2JpbGUtd3JhcCcgKSxcbiAgICAgICAgICAgIF93cmFwID0gX29iai5maW5kKCAnI3NpdGUtaGVhZGVyX19tb2JpbGUtbGF5b3V0JyApLFxuICAgICAgICAgICAgX21vYmlsZUJ0biA9ICQoICcjaGFtYnVyZ2VyJyApLFxuICAgICAgICAgICAgX2h0bWwgPSAkKCAnaHRtbCcgKSxcbiAgICAgICAgICAgIF9ib2R5ID0gJCggJ2JvZHknICksXG4gICAgICAgICAgICBfc2l0ZSA9IF9ib2R5LmZpbmQoICcjc2l0ZScgKSxcbiAgICAgICAgICAgIF9zaXRlSGVhZGVyID0gX3NpdGUuZmluZCggJyNzaXRlX19oZWFkZXInICksXG4gICAgICAgICAgICBfd2luZG93ID0gJCggd2luZG93ICksXG4gICAgICAgICAgICBfcG9zaXRpb24gPSAwO1xuXG4gICAgICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIHZhciBfb25FdmVudCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgX3dpbmRvdy5vbiggJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIF93aW5kb3cub3V0ZXJXaWR0aCgpID4gOTkyICl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfbW9iaWxlQnRuLnJlbW92ZUNsYXNzKCAnaXMtYWN0aXZlJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3NpdGVIZWFkZXIucmVtb3ZlQ2xhc3MoICdpcy1hY3RpdmUnICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIF9zaXRlLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoIGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggJCggZS50YXJnZXQgKS5jbG9zZXN0KCBfb2JqICkubGVuZ3RoID09PSAwICYmICQoIGUudGFyZ2V0ICkuY2xvc2VzdCggX21vYmlsZUJ0biApLmxlbmd0aCA9PT0gMCAmJiBfb2JqLmhhc0NsYXNzKCAnaXMtc2hvdycgKSApe1xuICAgICAgICAgICAgICAgICAgICAgICAgX2hpZGVNZW51KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICBfbW9iaWxlQnRuLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCAkKCB0aGlzICkuaGFzQ2xhc3MoICdpcy1hY3RpdmUnICkgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9oaWRlTWVudSgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3Nob3dNZW51KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oaWRlTWVudSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9tb2JpbGVCdG4ucmVtb3ZlQ2xhc3MoICdpcy1hY3RpdmUnICk7XG4gICAgICAgICAgICAgICAgX3NpdGVIZWFkZXIucmVtb3ZlQ2xhc3MoICdpcy1hY3RpdmUnICk7XG5cbiAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAnaXMtc2hvdycgKTtcbiAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUF0dHIoICdzdHlsZScgKTtcblxuICAgICAgICAgICAgICAgIGlmICggX3dpbmRvdy5vdXRlcldpZHRoKCkgPCA5OTIgKXtcblxuICAgICAgICAgICAgICAgICAgICBfaHRtbC5jc3MoICdvdmVyZmxvdy15JywgJ3Zpc2libGUnICk7XG4gICAgICAgICAgICAgICAgICAgIF9ib2R5LnJlbW92ZUF0dHIoICdzdHlsZScgKTtcbiAgICAgICAgICAgICAgICAgICAgX3NpdGUucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuXG4gICAgICAgICAgICAgICAgICAgIF93aW5kb3cuc2Nyb2xsVG9wKCBfcG9zaXRpb24gKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zaG93TWVudSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9tb2JpbGVCdG4uYWRkQ2xhc3MoICdpcy1hY3RpdmUnICk7XG4gICAgICAgICAgICAgICAgX3NpdGVIZWFkZXIuYWRkQ2xhc3MoICdpcy1hY3RpdmUnICk7XG5cbiAgICAgICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtc2hvdycgKTtcbiAgICAgICAgICAgICAgICBfb2JqLmNzcyggJ2hlaWdodCcsIF93cmFwLm91dGVySGVpZ2h0KCkgKyAyMCApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBfd2luZG93Lm91dGVyV2lkdGgoKSA8IDk5MiApe1xuXG4gICAgICAgICAgICAgICAgICAgIF9wb3NpdGlvbiA9IF93aW5kb3cuc2Nyb2xsVG9wKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgX2h0bWwuY3NzKCAnb3ZlcmZsb3cteScsICdoaWRkZW4nICk7XG4gICAgICAgICAgICAgICAgICAgIF9ib2R5LmNzcyggJ292ZXJmbG93LXknLCAnaGlkZGVuJyApO1xuXG4gICAgICAgICAgICAgICAgICAgIF9zaXRlLmNzcygge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICd0b3AnOiBfcG9zaXRpb24gKiAtMVxuICAgICAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgX29uRXZlbnQoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgICAgIC8vcHVibGljIG1ldGhvZHNcblxuICAgICAgICBfY29uc3RydWN0KCk7XG4gICAgfTtcblxufSApKCk7IiwiKCBmdW5jdGlvbigpe1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAkKCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgUHJlbG9hZGVyKCk7XG5cbiAgICAgICAgLyokLmVhY2goICQoICcucG9wdXBfX25vdGlmaWNhdGlvbnMnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBuZXcgVHJ1ZVVzZXIgKCk7XG4gICAgICAgICAgICAgICAgfSApOyovXG5cbiAgICAgICAgJC5lYWNoKCAkKCAnI2Jsb2cnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IEJsb2cgKCAkKCB0aGlzICkgKTtcbiAgICAgICAgfSApO1xuXG4gICAgICAgICQuZWFjaCggJCggJyNzZWFyY2gnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IFNlYXJjaEZvcm0gKCAkKCB0aGlzICkgKTtcbiAgICAgICAgfSApO1xuXG4gICAgICAgICQuZWFjaCggJCggJyN0by10b3AnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IFRvVG9wICggJCggdGhpcyApICk7XG4gICAgICAgIH0gKTtcblxuICAgICAgICAkLmVhY2goICQoICdpZnJhbWUnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IFNldFNpemVJZnJhbWUgKCAkKCB0aGlzICkgKTtcbiAgICAgICAgfSApO1xuXG4gICAgfSApO1xuXG4gICAgdmFyIEJsb2cgPSBmdW5jdGlvbiAoIG9iaiApIHtcblxuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9ibG9nV3JhcCA9IF9vYmouZmluZCggJyNibG9nX193cmFwJyApLFxuICAgICAgICAgICAgX2Jsb2dMaXN0ID0gX2Jsb2dXcmFwLmZpbmQoICcjYmxvZ19fbGlzdCcgKSxcbiAgICAgICAgICAgIF9ibG9nTG9hZE1vcmUgPSBfb2JqLmZpbmQoICcjYmxvZ19fbG9hZC1tb3JlJyApLFxuICAgICAgICAgICAgX2NhdGVnb3J5TGlzdCA9ICQoICcuY2F0ZWdvcmllcycgKSxcbiAgICAgICAgICAgIF9jYXRlZ29yeUl0ZW0gPSBfY2F0ZWdvcnlMaXN0LmZpbmQoICcuY2F0ZWdvcmllc19faXRlbScgKSxcbiAgICAgICAgICAgIF9jdXJyZW50SWQgPSBfY2F0ZWdvcnlJdGVtLmZpbHRlciggJy5pcy1hY3RpdmUnICkuZGF0YSggJ2lkJyApLFxuICAgICAgICAgICAgX2N1cnJlbnRQYWdlID0gMixcbiAgICAgICAgICAgIF9tYXhQYWdlID0gMixcbiAgICAgICAgICAgIF9jYW5TZW5kUmVxdWVzdCA9IHRydWUsXG4gICAgICAgICAgICAvLyBfdXJsID0gJ3BocC9ibG9nLmpzb24nLFxuICAgICAgICAgICAgX3VybCA9ICQoICcjc2l0ZV9fd3JhcCcgKS5kYXRhKCAnYWN0aW9uJyApLFxuICAgICAgICAgICAgX3JlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKSxcbiAgICAgICAgICAgIF93aW5kb3cgPSAkKCB3aW5kb3cgKSxcbiAgICAgICAgICAgIF9ib2R5ID0gJCggJ2h0bWwsIGJvZHknICksXG4gICAgICAgICAgICBfbW9udGhOYW1lcyA9IFsgXCJKYW5cIiwgXCJGZWJcIiwgXCJNYXJcIiwgXCJBcHJcIiwgXCJNYXlcIiwgXCJKdW5cIiwgXCJKdWxcIiwgXCJBdWdcIiwgXCJTZXBcIiwgXCJPY3RcIiwgXCJOb3ZcIiwgXCJEZWNcIiBdO1xuXG4gICAgICAgIHZhciBfb25FdmVudHMgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIF93aW5kb3cub24oIHtcbiAgICAgICAgICAgICAgICAgICAgJ3Njcm9sbCc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggKCBfd2luZG93Lm91dGVyV2lkdGgoKSA+PSA3NjggKSAmJiAgKCBfd2luZG93LnNjcm9sbFRvcCgpICsgX3dpbmRvdy5oZWlnaHQoKSA+PSBfYmxvZ1dyYXAub2Zmc2V0KCkudG9wICsgX2Jsb2dXcmFwLm91dGVySGVpZ2h0KCkgLSAxMCApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2FkRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAncmVzaXplJzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2Jsb2dXcmFwLmNzcyggJ2hlaWdodCcsIF9ibG9nTGlzdC5vdXRlckhlaWdodCgpICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICBfY2F0ZWdvcnlJdGVtLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF9jaGFuZ2VDYXRlZ29yeSggJCh0aGlzKSApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgX2Jsb2dMb2FkTW9yZS5vbiggJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfbG9hZERhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jaGFuZ2VDYXRlZ29yeSA9IGZ1bmN0aW9uICggb2JqICkge1xuXG4gICAgICAgICAgICAgICAgX2N1cnJlbnRQYWdlID0gMTtcbiAgICAgICAgICAgICAgICBfbWF4UGFnZSA9IDE7XG4gICAgICAgICAgICAgICAgX2NhblNlbmRSZXF1ZXN0ID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIF9jYXRlZ29yeUl0ZW0ucmVtb3ZlQ2xhc3MoICdpcy1hY3RpdmUnICk7XG4gICAgICAgICAgICAgICAgb2JqLmFkZENsYXNzKCAnaXMtYWN0aXZlJyApO1xuXG4gICAgICAgICAgICAgICAgX2Jsb2dMaXN0LmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgX2Jsb2dXcmFwLmNzcyggJ2hlaWdodCcsIF93aW5kb3cub3V0ZXJIZWlnaHQoKSAvIDIgKTtcblxuICAgICAgICAgICAgICAgIF9jdXJyZW50SWQgPSBvYmouZGF0YSggJ2lkJyApO1xuXG4gICAgICAgICAgICAgICAgX2xvYWREYXRhKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF93aW5kb3cub3V0ZXJXaWR0aCgpIDwgNzY4ICkge1xuICAgICAgICAgICAgICAgICAgICBfYmxvZ1dyYXAuY3NzKCAnaGVpZ2h0JywgX2Jsb2dMaXN0Lm91dGVySGVpZ2h0KCkgKTtcblxuICAgICAgICAgICAgICAgICAgICBfYm9keS5hbmltYXRlKCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IDBcbiAgICAgICAgICAgICAgICAgICAgfSwgNjAwKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2V0QmxvZ0l0ZW0gPSBmdW5jdGlvbiAoIGRhdGEgKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgYmxvZ0l0ZW0gPSBkYXRhLFxuICAgICAgICAgICAgICAgICAgICBibG9nSXRlbUxpbmsgPSBibG9nSXRlbS5saW5rLFxuICAgICAgICAgICAgICAgICAgICBibG9nSXRlbUltYWdlID0gYmxvZ0l0ZW0uaW1hZ2UsXG4gICAgICAgICAgICAgICAgICAgIGJsb2dJdGVtVGl0bGUgPSBibG9nSXRlbS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgYmxvZ0l0ZW1Db250ZW50ID0gYmxvZ0l0ZW0uY29udGVudCxcbiAgICAgICAgICAgICAgICAgICAgYmxvZ0l0ZW1EYXRlID0gYmxvZ0l0ZW0uZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0ZUFyciA9IGJsb2dJdGVtRGF0ZS5zcGxpdCgnLScpLFxuICAgICAgICAgICAgICAgICAgICBmcmFtZUl0ZW0gPSAkKCAnPGFydGljbGUgY2xhc3M9XCJibG9nX19pdGVtIGlzLW5ld1wiIC8+JyApLFxuICAgICAgICAgICAgICAgICAgICBibG9nQ29udGVudDtcblxuICAgICAgICAgICAgICAgIGlmICggYmxvZ0l0ZW1JbWFnZSApe1xuICAgICAgICAgICAgICAgICAgICBmcmFtZUl0ZW0uYXBwZW5kKCAnPGEgaHJlZj1cIicrIGJsb2dJdGVtTGluayArJ1wiIGNsYXNzPVwiYmxvZ19fcGljdHVyZVwiPjxpbWcgc3JjPVwiJysgYmxvZ0l0ZW1JbWFnZSArJ1wiIGFsdD1cIicrIGJsb2dJdGVtVGl0bGUgKydcIi8+PC9hPicgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBibG9nQ29udGVudCA9ICc8ZGl2IGNsYXNzPVwiYmxvZ19faXRlbS13cmFwXCI+PGRpdiBjbGFzcz1cImJsb2dfX2luZm9cIj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzx0aW1lIGNsYXNzPVwiYmxvZ19fZGF0ZVwiIGRhdGV0aW1lPVwiYmxvZ0l0ZW1EYXRlXCI+JysgX21vbnRoTmFtZXNbIGRhdGVBcnJbMV0gLSAxIF0gKycgJysgZGF0ZUFyclsyXSArJywgJysgZGF0ZUFyclswXSArJzwvdGltZT4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxhIGhyZWY9XCJodHRwczovL3R3aXR0ZXIuY29tL2ludGVudC9mb2xsb3c/b3JpZ2luYWxfcmVmZXJlcj1odHRwcyUzQSUyRiUyRnNvZnRzcG90YXBwLmNvbSUyRmJsb2clMkYmcmVmX3NyYz10d3NyYyU1RXRmdyZzY3JlZW5fbmFtZT1zb2Z0c3BvdGFwcCZ0d19wPWZvbGxvd2J1dHRvblwiIGNsYXNzPVwidHd0dHJcIj5cXG4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHhtbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiIHZpZXdCb3g9XCIwIDAgNDkuMyA0MFwiIHN0eWxlPVwiZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0OS4zIDQwO1wiIHhtbDpzcGFjZT1cInByZXNlcnZlXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICc8cGF0aCBkPVwiTTQ5LjMsNC43Yy0xLjgsMC44LTMuOCwxLjMtNS44LDEuNmMyLjEtMS4yLDMuNy0zLjIsNC40LTUuNmMtMiwxLjItNC4xLDItNi40LDIuNUMzOS42LDEuMiwzNywwLDM0LjEsMCcgK1xuICAgICAgICAgICAgICAgICAgICAnQzI4LjUsMCwyNCw0LjUsMjQsMTAuMWMwLDAuOCwwLjEsMS42LDAuMywyLjNDMTUuOSwxMiw4LjQsOCwzLjQsMS44QzIuNiwzLjMsMi4xLDUuMSwyLjEsNi45YzAsMy41LDEuOCw2LjYsNC41LDguNCcgK1xuICAgICAgICAgICAgICAgICAgICAnYy0xLjctMC4xLTMuMi0wLjUtNC42LTEuM2MwLDAsMCwwLjEsMCwwLjFjMCw0LjksMy41LDksOC4xLDkuOWMtMC44LDAuMi0xLjcsMC40LTIuNywwLjRjLTAuNywwLTEuMy0wLjEtMS45LTAuMmMxLjMsNCw1LDYuOSw5LjQsNycgK1xuICAgICAgICAgICAgICAgICAgICAnYy0zLjUsMi43LTcuOCw0LjMtMTIuNiw0LjNjLTAuOCwwLTEuNiwwLTIuNC0wLjFDNC41LDM4LjQsOS44LDQwLDE1LjUsNDBjMTguNiwwLDI4LjgtMTUuNCwyOC44LTI4LjhjMC0wLjQsMC0wLjksMC0xLjMnICtcbiAgICAgICAgICAgICAgICAgICAgJ0M0Ni4yLDguNSw0Ny45LDYuOCw0OS4zLDQuN3pcIi8+PC9zdmc+Rm9sbG93IEBzb2Z0c3BvdGFwcDwvYT48L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxhIGhyZWY9XCInKyBibG9nSXRlbUxpbmsgKydcIiBjbGFzcz1cImJsb2dfX2NvbnRlbnRcIj48aDIgY2xhc3M9XCJibG9nX190b3BpY1wiPjxzcGFuPicrIGJsb2dJdGVtVGl0bGUgKyc8L3NwYW4+PC9oMj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJibG9nX190ZXh0XCI+PHA+JysgYmxvZ0l0ZW1Db250ZW50ICsnPC9wPjwvZGl2PjwvYT48L2Rpdj4nO1xuXG4gICAgICAgICAgICAgICAgZnJhbWVJdGVtLmFwcGVuZCggYmxvZ0NvbnRlbnQgKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmcmFtZUl0ZW07XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbG9hZERhdGEgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBpZiggX2NhblNlbmRSZXF1ZXN0ICYmIF9jdXJyZW50UGFnZSA8PSBfbWF4UGFnZSApe1xuICAgICAgICAgICAgICAgICAgICBfc2VuZFJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2VuZFJlcXVlc3QgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIF9jYW5TZW5kUmVxdWVzdCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgX3JlcXVlc3QuYWJvcnQoKTtcbiAgICAgICAgICAgICAgICBfYmxvZ1dyYXAuYWRkQ2xhc3MoICdpcy1sb2FkaW5nJyApLnJlbW92ZUNsYXNzKCAnaXMtZW1wdHknICk7XG5cbiAgICAgICAgICAgICAgICBfcmVxdWVzdCA9ICQuYWpheCgge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IF91cmwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dldF9wb3N0c19ieV9jYXRlZ29yeScsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlOiBfY3VycmVudFBhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXhJZDogX2N1cnJlbnRJZFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiAyMDAwMCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfc2V0TGlzdCggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCBYTUxIdHRwUmVxdWVzdCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCAhPSBcImFib3J0XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvciggJ2VycicgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zZXRMaXN0ID0gZnVuY3Rpb24oIGRhdGEgKSB7XG5cbiAgICAgICAgICAgICAgICBfbWF4UGFnZSA9IGRhdGEubWF4UGFnZXM7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF9tYXhQYWdlID09PSAwICl7XG4gICAgICAgICAgICAgICAgICAgIF9ibG9nTG9hZE1vcmUuYWRkQ2xhc3MoICdpcy1oaWRkZW4nICk7XG4gICAgICAgICAgICAgICAgICAgIF9ibG9nV3JhcC5yZW1vdmVDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgYmxvZ0RhdGEgPSBkYXRhLmJsb2csXG4gICAgICAgICAgICAgICAgICAgIGJsb2dJdGVtVG90YWwgPSBibG9nRGF0YS5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGJsb2dJdGVtVG90YWwgPT09IDAgKXtcbiAgICAgICAgICAgICAgICAgICAgX2NhblNlbmRSZXF1ZXN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIF9ibG9nV3JhcC5hZGRDbGFzcyggJ2lzLWVtcHR5JyApLnJlbW92ZUNsYXNzKCAnaXMtbG9hZGluZycgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICQuZWFjaCggYmxvZ0RhdGEsIGZ1bmN0aW9uKCBpbmRleCApIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYmxvZ0ZyYW1lID0gX3NldEJsb2dJdGVtKCB0aGlzICk7XG5cbiAgICAgICAgICAgICAgICAgICAgX2Jsb2dMaXN0LmFwcGVuZCggYmxvZ0ZyYW1lICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBpbmRleCA9PT0gYmxvZ0l0ZW1Ub3RhbCAtIDEgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9ibG9nV3JhcC5yZW1vdmVDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfY2FuU2VuZFJlcXVlc3QgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBfYmxvZ1dyYXAuY3NzKCAnaGVpZ2h0JywgX2Jsb2dMaXN0Lm91dGVySGVpZ2h0KCkgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0l0ZW0gPSBfYmxvZ0xpc3QuZmluZCggJy5pcy1uZXcnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0l0ZW0uZWFjaCggZnVuY3Rpb24gKCBpICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1ckl0ZW0gPSAkKCB0aGlzICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfc2hvd05ld0l0ZW1zKCBjdXJJdGVtLCBpICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlID0gbmV3SXRlbS5maW5kKCAnaW1nJyApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZS5vbiggJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX2Jsb2dXcmFwLmNzcyggJ2hlaWdodCcsIF9ibG9nTGlzdC5vdXRlckhlaWdodCgpICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgX2N1cnJlbnRQYWdlID0gX2N1cnJlbnRQYWdlICsgMTtcblxuICAgICAgICAgICAgICAgIGlmICggX2N1cnJlbnRQYWdlID4gX21heFBhZ2UgICkge1xuICAgICAgICAgICAgICAgICAgICBfYmxvZ0xvYWRNb3JlLmFkZENsYXNzKCAnaXMtaGlkZGVuJyApXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX2Jsb2dMb2FkTW9yZS5yZW1vdmVDbGFzcyggJ2lzLWhpZGRlbicgKTtcbiAgICAgICAgICAgICAgICAgICAgX2NhblNlbmRSZXF1ZXN0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2hvd05ld0l0ZW1zID0gZnVuY3Rpb24gKCBpdGVtLCBpbmRleCApIHtcblxuICAgICAgICAgICAgICAgIHZhciBjdXJJdGVtID0gaXRlbTtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjdXJJdGVtLnJlbW92ZUNsYXNzKCAnaXMtbmV3JyApO1xuICAgICAgICAgICAgICAgIH0sIDEwMCAqIGluZGV4ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgX29uRXZlbnRzKCk7XG4gICAgICAgICAgICAgICAgX2xvYWREYXRhKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIF9jb25zdHJ1Y3QoKVxuICAgIH07XG5cbiAgICB2YXIgU2VhcmNoRm9ybSA9IGZ1bmN0aW9uKCBvYmogKSB7XG5cbiAgICAgICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICAgICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgICAgICBfc2VhcmNoRm9ybSA9IF9vYmouZmluZCggJyNzZWFyY2hfX2Zvcm0nICksXG4gICAgICAgICAgICBfc2VhcmNoSW5wdXQgPSBfc2VhcmNoRm9ybS5maW5kKCAnaW5wdXQnICksXG4gICAgICAgICAgICBfc2VhcmNoUG9wdXAgPSBfb2JqLmZpbmQoICcjc2VhcmNoX19wb3B1cCcgKSxcbiAgICAgICAgICAgIF9zZWFyY2hQb3B1cFNjcm9sbFdyYXAgPSBfc2VhcmNoUG9wdXAuZmluZCggJyNzZWFyY2hfX3BvcHVwLXNjcm9sbC13cmFwJyApLFxuICAgICAgICAgICAgX3Jlc3VsdFdyYXAgPSBfc2VhcmNoUG9wdXAuZmluZCggJyNzZWFyY2hfX3Jlc3VsdCcgKSxcbiAgICAgICAgICAgIC8vIF91cmwgPSAncGhwL3NlYXJjaC5qc29uJyxcbiAgICAgICAgICAgIF91cmwgPSAkKCAkKCAnI3NpdGVfX3dyYXAnICkgKS5kYXRhKCAnYWN0aW9uJyApLFxuICAgICAgICAgICAgX3NpdGUgPSAkKCAnI3NpdGUnICksXG4gICAgICAgICAgICBfcHMgPSBudWxsLFxuICAgICAgICAgICAgX3RpbWVyID0gbnVsbCxcbiAgICAgICAgICAgIF93aXRjaExldHRlclN0YXQgPSAyLFxuICAgICAgICAgICAgX3JlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgICAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgX29uRXZlbnQgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBfc2l0ZS5vbiggJ2NsaWNrJywgZnVuY3Rpb24gKCBlICkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggX3NlYXJjaFBvcHVwLmhhc0NsYXNzKCAnaXMtc2hvdycgKSAmJiAkKCBlLnRhcmdldCApLmNsb3Nlc3QoIF9vYmogKS5sZW5ndGggPT0gMCApe1xuICAgICAgICAgICAgICAgICAgICAgICAgX2hpZGVQb3B1cCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICBfc2VhcmNoSW5wdXQub24gKCAna2V5dXAnLCBmdW5jdGlvbiggZSApIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgc3ltYm9sTnVtYmVyID0gX3NlYXJjaElucHV0LnZhbCgpLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCBlLmtleUNvZGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI3OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9oaWRlUG9wdXAoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTMsIDI3LCAzNywgMzgsIDM5LCA0MDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZSkucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIHN5bWJvbE51bWJlciA+IF93aXRjaExldHRlclN0YXQgKXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVxdWVzdC5hYm9ydCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoIF90aW1lciApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aW1lciA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zZWFyY2hGb3JtLmhhc0NsYXNzKCAnaXMtc2hvdycgKSA/IF9hamF4UmVxdWVzdCgpIDogX3Nob3dQb3B1cCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCA1MDAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIHN5bWJvbE51bWJlciA8PSBfd2l0Y2hMZXR0ZXJTdGF0ICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yZXF1ZXN0LmFib3J0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCggX3RpbWVyICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9oaWRlUG9wdXAoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2FqYXhSZXF1ZXN0ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgX3NlYXJjaFBvcHVwLmFkZENsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuICAgICAgICAgICAgICAgIF9yZXF1ZXN0LmFib3J0KCk7XG5cbiAgICAgICAgICAgICAgICBfcmVxdWVzdCA9ICQuYWpheCgge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IF91cmwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dldF9zZWFyY2hfcmVzdWx0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaF92YWx1ZTogX3NlYXJjaElucHV0LnZhbCgpXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2xvYWREYXRhKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoIFhNTEh0dHBSZXF1ZXN0ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBYTUxIdHRwUmVxdWVzdC5zdGF0dXNUZXh0ICE9IFwiYWJvcnRcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCAnZXJyJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2xvYWREYXRhID0gZnVuY3Rpb24gKCBkYXRhICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGluZm87XG5cbiAgICAgICAgICAgICAgICBpbmZvID0gZGF0YS5yZXN1bHQ7XG5cbiAgICAgICAgICAgICAgICBfcmVzdWx0V3JhcC5lbXB0eSgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCAhaW5mbyApe1xuICAgICAgICAgICAgICAgICAgICBfc2VhcmNoUG9wdXAuYWRkQ2xhc3MoICdpcy1lbXB0eScgKS5yZW1vdmVDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfcHMgIT09IG51bGwgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfcHMuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3BzID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVjaXBlc1RvdGFsID0gaW5mby5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBpZiAoIHJlY2lwZXNUb3RhbCAhPT0gMCApe1xuXG4gICAgICAgICAgICAgICAgICAgIF9zZWFyY2hQb3B1cC5yZW1vdmVDbGFzcyggJ2lzLWVtcHR5JyApO1xuXG4gICAgICAgICAgICAgICAgICAgICQuZWFjaCggaW5mbywgZnVuY3Rpb24oIGluZGV4ICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVjaXBlc0l0ZW0gPSBfY3JlYXRlSXRlbUZyYW1lKCB0aGlzICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZXN1bHRXcmFwLmFwcGVuZCggcmVjaXBlc0l0ZW0gKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBpbmRleCA9PT0gcmVjaXBlc1RvdGFsIC0gMSApe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3NlYXJjaFBvcHVwLnJlbW92ZUNsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zZXRXcmFwSGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX3NlYXJjaFBvcHVwLmFkZENsYXNzKCAnaXMtZW1wdHknICkucmVtb3ZlQ2xhc3MoICdpcy1sb2FkaW5nJyApO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggX3BzICE9PSBudWxsICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3BzLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9wcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jcmVhdGVJdGVtRnJhbWUgPSBmdW5jdGlvbiAoIGRhdGEgKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVjaXBlc0l0ZW0gPSBkYXRhLFxuICAgICAgICAgICAgICAgICAgICByZWNpcGVzSXRlbUxpbmsgPSByZWNpcGVzSXRlbS5saW5rLFxuICAgICAgICAgICAgICAgICAgICByZWNpcGVzSXRlbVRpdGxlID0gcmVjaXBlc0l0ZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGZyYW1lSXRlbSA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICBmcmFtZUl0ZW0gPSAnPGEgaHJlZj1cIicrIHJlY2lwZXNJdGVtTGluayArJ1wiIGNsYXNzPVwic2VhcmNoX19yZXN1bHQtaXRlbVwiPicgK1xuICAgICAgICAgICAgICAgICAgICAnPHA+JysgcmVjaXBlc0l0ZW1UaXRsZSArJzwvcD48L2E+JztcblxuICAgICAgICAgICAgICAgIHJldHVybiBmcmFtZUl0ZW07XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2hvd1BvcHVwID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgX3NlYXJjaFBvcHVwLmFkZENsYXNzKCAnaXMtc2hvdycgKTtcbiAgICAgICAgICAgICAgICBfYWpheFJlcXVlc3QoKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zZXRXcmFwSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgX3NlYXJjaFBvcHVwLmNzcyggJ2hlaWdodCcsIF9yZXN1bHRXcmFwLm91dGVySGVpZ2h0KCkgKyAzNyApO1xuXG4gICAgICAgICAgICAgICAgX3NlYXJjaFBvcHVwLm9uKCAnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfcHMgPT0gbnVsbCApe1xuICAgICAgICAgICAgICAgICAgICAgICAgX2luaXRTY3JvbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9wcy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfc2VhcmNoUG9wdXAub2ZmKCAnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCcgKTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaGlkZVBvcHVwID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCAhX3NlYXJjaFBvcHVwLmhhc0NsYXNzKCAnaXMtc2hvdycgKSApe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgX3NlYXJjaFBvcHVwLnJlbW92ZUNsYXNzKCAnaXMtc2hvdycgKTtcblxuICAgICAgICAgICAgICAgIF9zZWFyY2hQb3B1cC5vbiggJ3dlYmtpdFRyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQgb1RyYW5zaXRpb25FbmQgbXNUcmFuc2l0aW9uRW5kIHRyYW5zaXRpb25lbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgX3Jlc3VsdFdyYXAuZW1wdHkoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIF9wcyAhPT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9wcy5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfcHMgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgX3NlYXJjaFBvcHVwLm9mZiggJ3dlYmtpdFRyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQgb1RyYW5zaXRpb25FbmQgbXNUcmFuc2l0aW9uRW5kIHRyYW5zaXRpb25lbmQnICk7XG5cbiAgICAgICAgICAgICAgICB9ICk7XG5cblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pbml0U2Nyb2xsID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCBfc2VhcmNoUG9wdXBTY3JvbGxXcmFwLm91dGVySGVpZ2h0KCkgPiBfc2VhcmNoUG9wdXAub3V0ZXJIZWlnaHQoKSAtIDM3ICl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlYXJjaFBvcHVwU2Nyb2xsV3JhcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoICcjc2VhcmNoX19wb3B1cC1zY3JvbGwtd3JhcCcgKTtcblxuICAgICAgICAgICAgICAgICAgICBfcHMgPSBuZXcgUGVyZmVjdFNjcm9sbGJhciggc2VhcmNoUG9wdXBTY3JvbGxXcmFwLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdXBwcmVzc1Njcm9sbFg6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NvbnN0cnVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljIHByb3BlcnRpZXNcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG5cbiAgICAgICAgX2NvbnN0cnVjdCgpO1xuXG4gICAgfTtcblxuICAgIHZhciBTZXRTaXplSWZyYW1lID0gZnVuY3Rpb24gKG9iaikge1xuXG4gICAgICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICAgICAgX3dpbmRvdyA9ICQoIHdpbmRvdyApO1xuXG4gICAgICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIHZhciBfb25FdmVudCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgX3dpbmRvdy5vbiggJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3NldFNpemUoKTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIHZhciB2aWRlb1dpZHRoID0gX29iai5vdXRlcldpZHRoKCk7XG5cbiAgICAgICAgICAgICAgICBfb2JqLmNzcyggJ2hlaWdodCcsIHZpZGVvV2lkdGggLyAxLjc3NzcgKyAncHgnICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgX29uRXZlbnQoKTtcbiAgICAgICAgICAgICAgICBfc2V0U2l6ZSgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9jb25zdHJ1Y3QoKTtcblxuICAgIH07XG5cbiAgICB2YXIgVG9Ub3AgPSBmdW5jdGlvbiggb2JqICkge1xuXG4gICAgICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICAgICAgX2FzaWRlID0gJCggJyNzaXRlX19hc2lkZScgKSxcbiAgICAgICAgICAgIF9ib2R5ID0gJCggJ2h0bWwsIGJvZHknICksXG4gICAgICAgICAgICBfd2luZG93ID0gJCggd2luZG93ICk7XG5cbiAgICAgICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIF9vbkV2ZW50ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgX3dpbmRvdy5vbiggJ3Njcm9sbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfd2luZG93LnNjcm9sbFRvcCgpID49IF9hc2lkZS5vZmZzZXQoKS50b3AgKyBfYXNpZGUub3V0ZXJIZWlnaHQoKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9vYmouYWRkQ2xhc3MoICdpcy1zaG93JyApXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAnaXMtc2hvdycgKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgX29iai5vbigge1xuICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJCdG4gPSAkKCB0aGlzICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9ib2R5LmFuaW1hdGUoIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IDBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDYwMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9jb25zdHJ1Y3QoKTtcblxuICAgIH07XG5cbiAgICB2YXIgVHJ1ZVVzZXIgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIF9jaGVja1VzZXIgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAvLyB2YXIgdHJ1ZVVzZXIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSggJ3RydWVVc2VyU29mdFNwb3QnICk7XG5cbiAgICAgICAgICAgICAgICAvLyBpZiAoICF0cnVlVXNlciApIHtcbiAgICAgICAgICAgICAgICAkKCAnI3BvcHVwJyApWzBdLm9iai5vcGVuUG9wdXAoICdub3RpZmljYXRpb25zJyApO1xuICAgICAgICAgICAgICAgIC8vIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCAndHJ1ZVVzZXJTb2Z0U3BvdCcsIHRydWUgKVxuICAgICAgICAgICAgICAgIC8vIH1cblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIF9jaGVja1VzZXIoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgICAgIC8vcHVibGljIG1ldGhvZHNcblxuICAgICAgICBfY29uc3RydWN0KCk7XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gUHJlbG9hZGVyICgpIHtcblxuICAgICAgICB2YXIgcHJlbG9hZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdwcmVsb2FkJyApLFxuICAgICAgICAgICAgbG9hZGluZ0xpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ3ByZWxvYWRfX2xvYWRpbmctbGluZScgKSxcbiAgICAgICAgICAgIGhlcm9TZWN0aW9uO1xuXG4gICAgICAgIC8vIE9uRXZlbnRzXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAnbG9hZCcsIExvYWRMaW5lICk7XG5cbiAgICAgICAgLy8gRnVuY3Rpb25zXG4gICAgICAgIGZ1bmN0aW9uIExvYWRMaW5lICgpIHtcblxuICAgICAgICAgICAgbG9hZGluZ0xpbmUuY2xhc3NMaXN0LmFkZCggJ2xvYWQnICk7XG5cbiAgICAgICAgICAgIFNob3dTaXRlKCk7XG5cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBTaG93U2l0ZSAoKSB7XG5cbiAgICAgICAgICAgIHByZWxvYWRlci5jbGFzc0xpc3QuYWRkKCAncHJlbG9hZF9sb2FkZWQnICk7XG5cbiAgICAgICAgICAgIHByZWxvYWRlci5hZGRFdmVudExpc3RlbmVyKCAndHJhbnNpdGlvbmVuZCcsIGZ1bmN0aW9uICggZSApIHtcbiAgICAgICAgICAgICAgICAoIGUucHJvcGVydHlOYW1lID09PSAnb3BhY2l0eScgKSAmJiBwcmVsb2FkZXIucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoICcuaXMtbG9hZGluZycgKS5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgICAgICAgICAkKCAnLmlzLWxvYWRpbmcnICkucmVtb3ZlQ2xhc3MoICdpcy1sb2FkaW5nJyApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxufSApKCk7Il19
